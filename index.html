<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bureau Pirate du Web</title>
  <link rel="stylesheet" href="index.css" />
</head>
<body>
    <div class="glitch-text" aria-label="Wbills Production" role="heading" aria-level="1">
        Wbills Production
    </div>


  <div class="desktop">
    <div class="icon" data-window="prods" tabindex="0">
      <img src="icons/folder-prods.png" alt="Prods" />
      <span>Prods</span>
    </div>
    <div class="icon" data-window="samples" tabindex="0">
      <img src="icons/folder-samples.png" alt="Samples" />
      <span>Samples</span>
    </div>
    <div class="icon" data-window="remix" tabindex="0">
      <img src="icons/folder-remix.png" alt="Remix" />
      <span>Remix</span>
    </div>
  </div>

  <div id="window-prods" class="window" data-window="prods" aria-hidden="true" role="dialog" aria-label="Fenêtre Prods">
    <div class="window-header">
      <span>Prods</span>
      <button aria-label="Fermer la fenêtre Prods" class="close-btn">&times;</button>
    </div>
    <div class="window-content">
      <p>Mes prods:</p>
      <audio controls src="audio/prod/house2.wav"></audio>
      <audio controls src="audio/prod2.mp3"></audio>
    </div>
  </div>

  <div id="window-samples" class="window" data-window="samples" aria-hidden="true" role="dialog" aria-label="Fenêtre Samples">
    <div class="window-header">
      <span>Samples</span>
      <button aria-label="Fermer la fenêtre Samples" class="close-btn">&times;</button>
    </div>
    <div class="window-content">
      <p>Quelques samples :</p>
      <audio controls src="audio/sample1.mp3"></audio>
      <audio controls src="audio/sample2.mp3"></audio>
    </div>
  </div>

  <div id="window-remix" class="window" data-window="remix" aria-hidden="true" role="dialog" aria-label="Fenêtre Remix">
    <div class="window-header">
      <span>Remix</span>
      <button aria-label="Fermer la fenêtre Remix" class="close-btn">&times;</button>
    </div>
    <div class="window-content">
      <p>Mes remix :</p>
      <audio controls src="audio/remix1.mp3"></audio>
      <audio controls src="audio/remix2.mp3"></audio>
    </div>
  </div>

  <div class="taskbar">
    <div class="taskbar-left">Wbills Production</div>
    <div class="taskbar-center">
      <button class="taskbar-btn" data-window="prods" aria-pressed="false">Prods</button>
      <button class="taskbar-btn" data-window="samples" aria-pressed="false">Samples</button>
      <button class="taskbar-btn" data-window="remix" aria-pressed="false">Remix</button>
    </div>
  </div>

  <script>
    // Mise à jour position curseur personnalisé
    window.addEventListener('mousemove', (e) => {
      document.body.style.setProperty('--cursor-x', e.clientX + 'px');
      document.body.style.setProperty('--cursor-y', e.clientY + 'px');
    });

    // Ouvrir fenêtre par icône
    document.querySelectorAll('.icon').forEach(icon => {
      icon.addEventListener('click', () => {
        const winName = icon.getAttribute('data-window');
        openWindow(winName);
      });
      icon.addEventListener('keydown', e => {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          const winName = icon.getAttribute('data-window');
          openWindow(winName);
        }
      });
    });

    // Ouvrir fenêtre par bouton taskbar
    document.querySelectorAll('.taskbar-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const winName = btn.getAttribute('data-window');
        toggleWindow(winName);
      });
    });

    // Fermer fenêtre par bouton X
    document.querySelectorAll('.close-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const win = btn.closest('.window');
        closeWindow(win.getAttribute('data-window'));
      });
    });

    function openWindow(name) 
    {
        const win = document.querySelector(`#window-${name}`);
        if (!win) return;

        // Si ce n’est pas déjà positionné, centre la fenêtre
        if (!win.classList.contains('positioned')) {
            const centerX = (window.innerWidth - win.offsetWidth) / 2;
            const centerY = (window.innerHeight - win.offsetHeight - 40) / 2; // 40 = taskbar
            win.style.left = `${centerX}px`;
            win.style.top = `${centerY}px`;
            win.classList.add('positioned');
        }

        win.classList.add('active');
        win.setAttribute('aria-hidden', 'false');
        updateTaskbarButton(name, true);
        bringToFront(win);
    }

    function closeWindow(name) {
      const win = document.querySelector(`#window-${name}`);
      if (!win) return;
      win.classList.remove('active');
      win.setAttribute('aria-hidden', 'true');

      updateTaskbarButton(name, false);
      pauseAudios(win);
    }
    function toggleWindow(name) {
      const win = document.querySelector(`#window-${name}`);
      if (!win) return;
      if (win.classList.contains('active')) {
        closeWindow(name);
      } else {
        openWindow(name);
      }
    }

    function updateTaskbarButton(name, isActive) {
      const btn = document.querySelector(`.taskbar-btn[data-window="${name}"]`);
      if (!btn) return;
      btn.classList.toggle('active', isActive);
      btn.setAttribute('aria-pressed', isActive);
    }

    function pauseAudios(win) {
      const audios = win.querySelectorAll('audio');
      audios.forEach(audio => {
        audio.pause();
        audio.currentTime = 0;
      });
    }

    // Fenêtres déplaçables
    let zIndexCounter = 20;
    document.querySelectorAll('.window').forEach(win => {
      const header = win.querySelector('.window-header');
      let isDragging = false;
      let offsetX = 0;
      let offsetY = 0;

      header.style.cursor = 'grab';

      header.addEventListener('mousedown', e => {
        isDragging = true;
        offsetX = e.clientX - win.getBoundingClientRect().left;
        offsetY = e.clientY - win.getBoundingClientRect().top;
        win.style.zIndex = ++zIndexCounter;
        header.style.cursor = 'grabbing';
      });
      window.addEventListener('mouseup', () => {
        isDragging = false;
        header.style.cursor = 'grab';
      });
      window.addEventListener('mousemove', e => {
        if (!isDragging) return;
        let newX = e.clientX - offsetX;
        let newY = e.clientY - offsetY;

        // Limiter pour ne pas sortir de l'écran
        const winRect = win.getBoundingClientRect();

        if (newX < 0) newX = 0;
        else if (newX + winRect.width > window.innerWidth) newX = window.innerWidth - winRect.width;

        if (newY < 0) newY = 0;
        else if (newY + winRect.height > window.innerHeight - 40) newY = window.innerHeight - winRect.height - 40; // 40 = taskbar

        win.style.left = newX + 'px';
        win.style.top = newY + 'px';
        win.style.transform = 'translate(0,0)';
      });
    });

    // Focus fenêtre au clic (met à jour z-index)
    document.querySelectorAll('.window').forEach(win => {
      win.addEventListener('mousedown', () => {
        win.style.zIndex = ++zIndexCounter;
      });
    });

    // Fonction pour amener une fenêtre au premier plan
    function bringToFront(win) {
      win.style.zIndex = ++zIndexCounter;
    }
  </script>
</body>
</html>
